var Ajax={createCORSRequest:function(t,e){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(t,e,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(t,e):n=null,n},request:function(t,e){var n=this.createCORSRequest("POST",t);if(n&&(n.withCredentials=!0,n.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest"),n.onreadystatechange=function(){4==n.readyState&&(200==n.status||304==n.status?e.onSuccess(n.responseText):e.onFailure&&e.onFailure(n.status,n.responseText))},4!=n.readyState))return n.send(),!0}},FlattrButton={doFlattr:function(t){var e={method:"post",onSuccess:function(e){window.parent.postMessage(JSON.stringify({flattr_button_event:"click_successful"}),"*");var n=document.querySelector(".flattr-count span"),a=parseInt(n.innerHTML)||0;n.innerHTML=++a,t.className="flattr flattr-ed",t.querySelector("span.flattr-link").className="flattr-flattred";var r=t.href.match(/^(.+)\/flattr\/(.+)$/i);t.href=r[1]+"/subscribe/"+r[2],t.title="Subscribe"},onFailure:function(t,e){if(!window.useEvents&&(401==t||402==t))return e=JSON.parse(e),void(window.parent.location.href=e.url);401!=t&&402!=t?window.location.reload(!0):window.parent.postMessage(JSON.stringify({flattr_button_event:"unauthorized"}),"*")}};Ajax.request(t.href,e)||window.location.reload(!0)},doSubscribe:function(t){var e={method:"post",onSuccess:function(e){window.parent.postMessage(JSON.stringify({flattr_button_event:"subscribe_successful"}),"*");var n=document.createElement("span");n.className="flattr-subscribed";var a=document.createElement("span");a.className="flattr",a.appendChild(n),t.parentNode.replaceChild(a,t)},onFailure:function(t,e){window.location.reload(!0)}};Ajax.request(t.href,e)},init:function(){if(document.querySelectorAll){var t,e,n=document.querySelectorAll(".flattr");for(t=0,e=n.length;t<e;t++)n[t].onclick=function(){return/\bflattr-ajax\b/.test(this.className)?FlattrButton.doFlattr(this):/\bflattr-ed\b/.test(this.className)&&FlattrButton.doSubscribe(this),!1}}else{var a=document.getElementsByTagName("div")[0];a.parentNode.removeChild(a)}}};window.onload=function(){FlattrButton.init()};